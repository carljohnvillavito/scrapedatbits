<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScrapeDatBits</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Scrollbar */
        textarea::-webkit-scrollbar { width: 6px; height: 6px; }
        textarea::-webkit-scrollbar-track { background: transparent; }
        textarea::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        .glass-panel {
            background: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        
        body { overscroll-behavior-y: none; }
    </style>
</head>
<body class="bg-[#050505] text-gray-200 min-h-screen flex flex-col font-sans selection:bg-cyan-500/30 selection:text-cyan-200">

    <!-- Header -->
    <header class="pt-8 pb-4 text-center px-4">
        <h1 class="text-3xl md:text-5xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-cyan-400 to-teal-400 mb-2 drop-shadow-lg">
            ScrapeDatBits
        </h1>
        <p class="text-gray-500 text-xs md:text-sm uppercase tracking-[0.2em] font-medium">Minimalist URL Scraper</p>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col items-center w-full max-w-6xl mx-auto px-4 pb-4">
        
        <!-- Input Section -->
        <div class="w-full max-w-3xl relative group mb-4">
            <!-- Glow Effect (Z-Index 0) -->
            <div class="absolute -inset-0.5 bg-gradient-to-r from-indigo-500 to-cyan-500 rounded-lg blur opacity-20 group-hover:opacity-60 transition duration-300 z-0"></div>
            
            <!-- Actual Content (Z-Index 20 - Forces it to be clickable) -->
            <div class="relative z-20 flex flex-col sm:flex-row items-stretch sm:items-center bg-gray-900 rounded-lg border border-gray-800 shadow-xl overflow-hidden">
                <input type="text" id="urlInput" placeholder="https://example.com" 
                    class="w-full bg-transparent border-none outline-none text-white px-5 py-4 placeholder-gray-600 text-sm md:text-base font-mono z-20"
                    onkeydown="if(event.key === 'Enter') scrapeSite()">
                
                <button onclick="scrapeSite()" type="button"
                    class="z-20 cursor-pointer sm:w-auto w-full px-8 py-4 sm:py-0 bg-gray-800 hover:bg-gray-700 active:bg-gray-600 active:scale-95 text-cyan-400 hover:text-cyan-300 transition-all duration-100 font-bold uppercase tracking-wider text-xs border-t sm:border-t-0 sm:border-l border-gray-700">
                    Scrape
                </button>
            </div>
        </div>

        <!-- Toolbar -->
        <div id="toolbar" class="w-full max-w-3xl flex flex-wrap justify-between items-center gap-2 mb-3 opacity-0 transition-opacity duration-300 pointer-events-none">
            <span class="text-[10px] md:text-xs text-gray-500 font-mono" id="statusText">Waiting for input...</span>
            <div class="flex gap-2 pointer-events-auto">
                <button onclick="copyToClipboard()" class="flex items-center gap-1.5 px-3 py-1.5 text-[10px] md:text-xs font-medium bg-gray-800/80 hover:bg-gray-700 text-gray-300 rounded border border-gray-700 transition">
                    <i data-lucide="copy" class="w-3 h-3"></i> Copy
                </button>
                <button onclick="downloadFile('html')" class="flex items-center gap-1.5 px-3 py-1.5 text-[10px] md:text-xs font-medium bg-gray-800/80 hover:bg-gray-700 text-gray-300 rounded border border-gray-700 transition">
                    <i data-lucide="file-code" class="w-3 h-3"></i> .HTML
                </button>
                <button onclick="downloadFile('txt')" class="flex items-center gap-1.5 px-3 py-1.5 text-[10px] md:text-xs font-medium bg-gray-800/80 hover:bg-gray-700 text-gray-300 rounded border border-gray-700 transition">
                    <i data-lucide="file-text" class="w-3 h-3"></i> .TXT
                </button>
            </div>
        </div>

        <!-- Output View -->
        <div class="w-full h-[60vh] md:h-[70vh] relative rounded-xl overflow-hidden glass-panel flex flex-col shadow-2xl ring-1 ring-white/5">
            <!-- Window Title Bar -->
            <div class="absolute top-0 left-0 w-full h-10 bg-[#0f1115] border-b border-white/5 flex items-center px-4 gap-2 z-20 shrink-0 select-none">
                <div class="flex gap-1.5">
                    <div class="w-2.5 h-2.5 rounded-full bg-red-500/80 hover:bg-red-500 transition"></div>
                    <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/80 hover:bg-yellow-500 transition"></div>
                    <div class="w-2.5 h-2.5 rounded-full bg-green-500/80 hover:bg-green-500 transition"></div>
                </div>
                <div class="ml-4 text-[10px] text-gray-600 font-mono uppercase tracking-widest truncate" id="windowTitle">
                    view_source.html
                </div>
            </div>

            <!-- The Content Area -->
            <textarea id="outputArea" readonly spellcheck="false"
                class="w-full h-full bg-transparent text-xs md:text-sm font-mono text-gray-300 p-4 pt-14 outline-none resize-none leading-relaxed whitespace-pre shadow-inner"></textarea>
        </div>

    </main>

    <!-- Logic -->
    <script>
        // --- 1. Define Functions First (Safest Way) ---

        async function scrapeSite() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value;
            const output = document.getElementById('outputArea');
            const toolbar = document.getElementById('toolbar');
            const status = document.getElementById('statusText');
            const winTitle = document.getElementById('windowTitle');

            if (!url) {
                urlInput.focus();
                return;
            }

            // Reset UI
            output.value = "";
            output.placeholder = "Initializing handshake...\nEstablishing secure connection...\nFetching packets...";
            status.innerText = "Requesting data...";
            status.className = "text-[10px] md:text-xs text-yellow-500 font-mono animate-pulse";
            toolbar.classList.remove('opacity-0', 'pointer-events-none');
            // Re-enable pointer events for buttons inside toolbar
            const toolbarButtons = toolbar.querySelector('div');
            if(toolbarButtons) toolbarButtons.classList.add('pointer-events-auto');

            winTitle.innerText = `Scraping: ${url.replace('https://', '').substring(0, 30)}...`;

            try {
                const response = await fetch(`/api/scrape?site=${encodeURIComponent(url)}`);
                const data = await response.text();

                if (response.ok) {
                    output.value = data;
                    output.placeholder = ""; 
                    const size = new TextEncoder().encode(data).length;
                    status.innerText = `Success (200 OK) â€¢ ${formatBytes(size)}`;
                    status.className = "text-[10px] md:text-xs text-emerald-400 font-mono";
                    winTitle.innerText = `source_${new Date().getTime()}.html`;
                } else {
                    output.value = `/* ERROR LOG */\n\n${data}`;
                    status.innerText = "Connection Failed";
                    status.className = "text-[10px] md:text-xs text-red-500 font-mono";
                }
            } catch (err) {
                console.error(err);
                output.value = `/* SYSTEM FAILURE */\n\nCould not reach the server API.\nCheck your internet connection.`;
                status.innerText = "Network Error";
                status.className = "text-[10px] md:text-xs text-red-500 font-mono";
            }
        }

        function formatBytes(bytes, decimals = 2) {
            if (!+bytes) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
        }

        function copyToClipboard() {
            const content = document.getElementById('outputArea');
            content.select();
            content.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            const status = document.getElementById('statusText');
            const prevText = status.innerText;
            const prevClass = status.className;
            
            status.innerText = "Copied to clipboard!";
            status.className = "text-[10px] md:text-xs text-indigo-400 font-mono font-bold";
            
            setTimeout(() => {
                status.innerText = prevText;
                status.className = prevClass;
            }, 2000);
        }

        function downloadFile(type) {
            const content = document.getElementById('outputArea').value;
            if(!content) return;
            const blob = new Blob([content], { type: type === 'html' ? 'text/html' : 'text/plain' });
            const anchor = document.createElement('a');
            anchor.href = URL.createObjectURL(blob);
            anchor.download = `scraped_${new Date().getTime()}.${type}`;
            document.body.appendChild(anchor);
            anchor.click();
            document.body.removeChild(anchor);
        }

        // --- 2. Initialize Icons Last (Prevents blocking) ---
        document.addEventListener('DOMContentLoaded', () => {
            try {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            } catch (e) {
                console.log('Icons failed to load, functionality remains.');
            }
        });
    </script>
</body>
</html>
